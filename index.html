<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RP í†µí•© ë§¤ë‹ˆì € - HABOM</title>
    <!-- Pretendard í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <style>
        :root { 
            --primary: #3182f6;    /* Toss Blue */
            --toss-gray: #f2f4f6;
            --toss-text-main: #191f28;
            --toss-text-sub: #4e5968;
            --toss-text-desc: #8b95a1;
            --white: #ffffff;
            --danger: #f04452;
            --atk-color: #f76707;
            --def-color: #495057;
            --shadow: 0 4px 24px rgba(0,0,0,0.06);
            --nav-height: 75px; 
        }

        /* ê¸°ë³¸ ì„¤ì • */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; letter-spacing: -0.02em; }
        body { 
            background: var(--toss-gray); 
            color: var(--toss-text-main); 
            margin: 0; 
            padding: 0;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            font-size: 16px;
            padding-bottom: var(--nav-height); 
        }

        /* ê³µí†µ ì»¨í…Œì´ë„ˆ - í™”ë©´ì„ ê°€ë“ ì±„ìš°ë„ë¡ min-height ì„¤ì • */
        .app-container { 
            width: 100%; 
            max-width: 760px; 
            background: var(--white); 
            padding: 2.5rem 1.5rem; 
            border-radius: 0 0 2.5rem 2.5rem; 
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - var(--nav-height));
            position: relative;
        }

        header { margin-bottom: 2rem; position: relative; text-align: center; }
        header h1 { font-size: 1.6rem; font-weight: 800; margin: 0; }
        header .sub-title { font-size: 0.9rem; color: var(--danger); font-weight: 700; margin-top: 6px; display: block; }

        .help-icon {
            position: absolute; top: 0; right: 0; width: 28px; height: 28px;
            background: none; color: var(--toss-text-desc); border: 2.2px solid #e5e8eb;
            border-radius: 50%; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.85rem;
        }

        /* íƒ­ ì‹œìŠ¤í…œ */
        .tab-content { display: none; width: 100%; animation: fadeIn 0.4s ease; flex-direction: column; flex: 1; }
        .tab-content.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- [íƒ­ 1] ì¸ì› ê³„ì‚°ê¸° ìŠ¤íƒ€ì¼ --- */
        .summary-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 2.5rem; }
        .step-indicator { 
            background: #f9fafb; padding: 1.2rem 0.5rem; border-radius: 1.2rem; text-align: center;
            border: 2px solid transparent; transition: 0.3s;
        }
        .step-indicator.active { border-color: var(--primary); background: #fff; box-shadow: 0 4px 10px rgba(49, 130, 246, 0.1); }
        .label { font-size: 0.85rem; font-weight: 600; color: var(--toss-text-sub); margin-bottom: 6px; display: block; }
        .val { font-size: 1.3rem; font-weight: 800; color: var(--primary); }

        .input-hero { text-align: center; margin-bottom: 2rem; }
        .input-hero .title { font-size: 1.1rem; font-weight: 600; color: var(--toss-text-sub); display: block; margin-bottom: 15px; }
        .input-hero .number { font-size: 4.5rem; font-weight: 800; color: var(--toss-text-main); letter-spacing: -2px; }

        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 100%; max-width: 400px; margin: 0 auto 1.5rem auto; }
        .key { 
            height: 75px; font-size: 1.6rem; font-weight: 600; background: #f9fafb; 
            border: none; border-radius: 1.2rem; cursor: pointer; 
            transition: all 0.1s; display: flex; align-items: center; justify-content: center;
        }
        .key:active { background: #e5e8eb; transform: scale(0.95); }
        .key.enter { background: var(--primary); color: white; font-size: 1.1rem; font-weight: 700; }
        .key.del { color: var(--toss-text-sub); }

        .section-card { background: #f9fafb; border-radius: 1.8rem; padding: 1.8rem; margin-bottom: 1.5rem; }
        .section-header { display: flex; align-items: center; gap: 8px; margin-bottom: 1.2rem; }
        .section-header .title { font-size: 1.1rem; font-weight: 700; color: var(--toss-text-main); }

        .btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .p-btn { 
            height: 52px; border: none; border-radius: 0.9rem; background: #fff;
            color: var(--toss-text-sub); font-weight: 700; font-size: 0.95rem; 
            cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.04); transition: 0.2s;
        }
        .p-btn:active { background: #f2f4f6; transform: scale(0.97); }
        .p-btn.highlight { background: var(--toss-text-main); color: #fff; }

        .result-box-container { display: none; }
        .result-card { 
            border: 2.5px solid var(--primary); padding: 2.5rem 1.5rem; 
            border-radius: 2.2rem; text-align: center; margin-top: 2rem; background: rgba(49, 130, 246, 0.01);
        }
        .res-num { font-size: 5rem; font-weight: 800; color: var(--primary); margin: 0.5rem 0; line-height: 1; }
        .preview-box { background: #f2f4f6; padding: 1.2rem; border-radius: 1.2rem; margin: 1.5rem 0; font-weight: 700; color: var(--toss-text-sub); line-height: 1.6; }
        .copy-btn { width: 100%; height: 65px; background: var(--primary); color: white; border: none; border-radius: 1.2rem; font-size: 1.2rem; font-weight: 700; cursor: pointer; transition: 0.2s; }

        /* --- [íƒ­ 2] ìŠ¤ì½”ì–´ë³´ë“œ ìŠ¤íƒ€ì¼ --- */
        .persistent-settings { background: #f9fafb; border-radius: 1.5rem; padding: 1.2rem 1.8rem; margin-bottom: 1.5rem; }
        /* ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ ì¡°ì •: ì¸ì›(0.8) íŒ¨ë°°ê¸ˆ(0.8) ì„ í¬íŒ€(1.4) */
        .settings-row { display: grid; grid-template-columns: 0.8fr 0.8fr 1.4fr; gap: 12px; align-items: flex-end; }
        .setting-item { display: flex; flex-direction: column; gap: 6px; }
        .label-sm { font-size: 0.8rem; font-weight: 700; color: var(--toss-text-desc); }
        select { height: 50px; border: 1.5px solid #e5e8eb; border-radius: 12px; font-weight: 800; font-size: 1.05rem; color: var(--toss-text-main); background: #fff; text-align: center; outline: none; }
        .init-btns-mini { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-init-mini { height: 50px; border: 1.5px solid #e5e8eb; border-radius: 12px; background: white; font-size: 0.9rem; cursor: pointer; font-weight: 700; color: var(--toss-text-sub); }
        .btn-init-mini.active-a { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-init-mini.active-b { background: var(--danger); color: white; border-color: var(--danger); }

        .scoreboard { display: flex; align-items: center; justify-content: space-around; margin-bottom: 1.5rem; background: #f9fafb; padding: 2.2rem 1.2rem; border-radius: 2.2rem; }
        .team-box { text-align: center; flex: 1; }
        .score-large { font-size: 2.2rem; font-weight: 800; color: var(--toss-text-sub); line-height: 1; }
        .score-small { font-size: 8.5rem; font-weight: 950; line-height: 0.85; margin: 12px 0; letter-spacing: -6px; }
        .team-a .score-small { color: var(--primary); }
        .team-b .score-small { color: var(--danger); }
        .pos-badge { display: inline-block; padding: 6px 20px; border-radius: 10px; font-size: 1rem; font-weight: 800; color: white; margin-top: 5px; }
        .bg-atk { background: var(--atk-color); }
        .bg-def { background: var(--def-color); }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 1.2rem; }
        .btn-win { height: 100px; border: none; border-radius: 1.5rem; font-size: 1.4rem; font-weight: 800; color: white; cursor: pointer; transition: 0.1s; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn-win span { font-size: 0.8rem; opacity: 0.7; margin-top: 6px; }
        .btn-win-a { background: var(--primary); }
        .btn-win-b { background: var(--danger); }
        .btn-win:active { transform: scale(0.96); }

        /* ì±„íŒ… ìŠ¤ì½”ì–´ ë³µì‚¬ ë°” ì„¸ë¡œ ë„ˆë¹„ ì¶•ì†Œ */
        .copy-bar { background: var(--toss-text-main); color: white; padding: 0.6rem 1.8rem; border-radius: 1.2rem; text-align: center; margin-bottom: 1.2rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .chat-val { font-size: 1.8rem; font-weight: 900; letter-spacing: 4px; }
        
        /* ìŠ¤ì½”ì–´ë³´ë“œ í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ê³ ì • */
        .h-table { width: 100%; border-collapse: collapse; text-align: center; font-size: 1.05rem; table-layout: fixed; }
        .h-table th { padding: 14px 5px; color: var(--toss-text-sub); font-size: 1rem; border-bottom: 2px solid #e5e8eb; }
        .h-table td { padding: 14px 5px; font-weight: 800; border-bottom: 1px solid #eff2f5; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        /* ì—´ ë„ˆë¹„ ê°•ì œ ê³ ì • (í•©ê³„ 100%) */
        .h-table th:nth-child(1) { width: 25%; }
        .h-table th:nth-child(2) { width: 37.5%; }
        .h-table th:nth-child(3) { width: 37.5%; }

        .hist-winner-a { background-color: #f0f7ff !important; color: var(--primary); }
        .hist-winner-b { background-color: #fff5f5 !important; color: var(--danger); }

        .settle-card { padding: 1.5rem 1.8rem; background: #f0f7ff; border-radius: 1.5rem; text-align: center; margin-top: 1rem; display: flex; align-items: center; justify-content: space-between; }
        .money-val { font-size: 1.4rem; font-weight: 900; color: var(--primary); }
        .btn-copy-num { padding: 12px 22px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ - í™”ë©´ í•˜ë‹¨ ë¶€ì°© í† ìŠ¤ ìŠ¤íƒ€ì¼ */
        .bottom-nav {
            position: fixed; 
            bottom: 0; 
            left: 50%; 
            transform: translateX(-50%);
            width: 100%; 
            max-width: 760px; 
            height: var(--nav-height);
            background: #ffffff; 
            display: flex; 
            justify-content: space-around; 
            align-items: center;
            border-top: 1px solid rgba(0,0,0,0.08);
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            z-index: 1000; 
            box-shadow: 0 -8px 25px rgba(0,0,0,0.05);
            padding: 0 10px;
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; gap: 4px; color: #b0b8c1; cursor: pointer; transition: 0.2s;
            height: 100%;
        }
        .nav-item.active { color: var(--primary); }
        .nav-item .emoji-icon {
            font-size: 26px;
            line-height: 1;
            transition: transform 0.2s;
        }
        .nav-item.active .emoji-icon { transform: scale(1.1); }
        .nav-item span { font-size: 11px; font-weight: 700; color: #6b7684; }
        .nav-item.active span { color: var(--primary); }
        .nav-item:active { background: rgba(0,0,0,0.02); }

        /* í‘¸í„° ì‹œê·¸ë‹ˆì²˜ - ë°•ìŠ¤ ìµœí•˜ë‹¨ ê³ ì • */
        footer { 
            margin-top: auto; 
            padding: 3rem 0 1rem 0; 
            text-align: center; 
            opacity: 0.6; 
        }
        .sig-line { width: 30px; height: 1.5px; background: #d1d6db; margin: 0 auto 12px auto; }
        .sig-crafted { font-size: 0.65rem; color: #8b95a1; font-weight: 800; letter-spacing: 0.2em; text-transform: uppercase; margin-bottom: 4px; display: block; }
        .sig-habom { font-size: 1.1rem; letter-spacing: 0.4em; color: #b0b8c1; font-weight: 900; }

        @media (max-width: 650px) {
            .app-container { padding: 1.5rem 1rem; border-radius: 0; }
            .score-small { font-size: 5.5rem; letter-spacing: -3px; }
            .chat-val { font-size: 1.6rem; }
            .res-num { font-size: 3.5rem; }
            .numpad { gap: 10px; }
            .key { height: 65px; border-radius: 1rem; }
            /* ëª¨ë°”ì¼ì—ì„œ ì„¤ì •ì°½ í•œ ë²ˆ ë” ìµœì í™” */
            .settings-row { grid-template-columns: 1fr 1fr; }
            .setting-item:last-child { grid-column: span 2; margin-top: 10px; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- [íƒ­ 1] ìŠ¤ì½”ì–´ë³´ë“œ ì„¹ì…˜ (ê¸°ì¡´ active íƒ­) -->
    <div id="tab-scoreboard" class="tab-content active">
        <header>
            <h1>âš”ï¸ ì§€ìƒ RP ìŠ¤ì½”ì–´ë³´ë“œ âš”ï¸</h1>
            <span class="sub-title">ë‹¹ì‹ ë„ ì´ì œ ë¼ìš´ë“œê±¸ âœ¨ ì°¡ê¸‹- ğŸ˜‰ğŸ’•</span>
            <button class="help-icon" onclick="alert('Q/1: ìš°ë¦¬íŒ€ ë“ì \nE/2: ìƒëŒ€íŒ€ ë“ì ')">?</button>
        </header>

        <div class="persistent-settings">
            <div class="settings-row">
                <div class="setting-item">
                    <span class="label-sm">ì¸ì›</span>
                    <select id="mems" onchange="renderScoreboard()"><option value="2">2ëª…</option><option value="3">3ëª…</option><option value="4">4ëª…</option><option value="5">5ëª…</option><option value="6">6ëª…</option><option value="7" selected>7ëª…</option></select>
                </div>
                <div class="setting-item">
                    <span class="label-sm">íŒ¨ë°°ê¸ˆ</span>
                    <select id="betAmount" onchange="renderScoreboard()"><option value="1">1ì²œë§Œ</option><option value="2">2ì²œë§Œ</option><option value="3" selected>3ì²œë§Œ</option><option value="4">4ì²œë§Œ</option><option value="5">5ì²œë§Œ</option></select>
                </div>
                <div class="setting-item">
                    <span class="label-sm">ìµœì´ˆ ì„ í¬íŒ€</span>
                    <div class="init-btns-mini">
                        <button id="miniA" class="btn-init-mini" onclick="setInitial('A')">ìš°ë¦¬íŒ€</button>
                        <button id="miniB" class="btn-init-mini" onclick="setInitial('B')">ìƒëŒ€íŒ€</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="setup-screen" style="text-align:center; padding: 3rem 0;">
            <span style="font-size: 1.2rem; font-weight: 800; color: var(--toss-text-main); margin-bottom: 2rem; display: block;">ê²Œì„ì„ ì‹œì‘í•  ì„ í¬íŒ€ì„ ì„ íƒí•˜ì„¸ìš”</span>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; max-width:400px; margin:0 auto;">
                <button style="height:100px; border:none; border-radius:1.8rem; background:var(--primary); color:white; font-size:1.3rem; font-weight:900; cursor:pointer;" onclick="setInitial('A')">ìš°ë¦¬íŒ€ ì„ í¬</button>
                <button style="height:100px; border:none; border-radius:1.8rem; background:var(--danger); color:white; font-size:1.3rem; font-weight:900; cursor:pointer;" onclick="setInitial('B')">ìƒëŒ€íŒ€ ì„ í¬</button>
            </div>
        </div>

        <div id="board-screen" style="display:none;">
            <div style="background:#fff; padding:10px 25px; border-radius:50px; text-align:center; margin:0 auto 1.5rem auto; border:2px solid #e5e8eb; display:table; font-weight:800;">
                ğŸ”„ ë‹¤ìŒ ì—­ì„ í¬ ì°¨ë¡€: <b id="revTeam" style="color:var(--primary); margin-left:8px;">-</b>
            </div>

            <div class="scoreboard">
                <div class="team-box team-a">
                    <span class="label-sm">í°ìŠ¤</span>
                    <div class="score-large" id="lScoreA">0</div>
                    <div class="score-small" id="sScoreA">0</div>
                    <div id="badgeA" class="pos-badge">ëŒ€ê¸°</div>
                </div>
                <div style="font-size: 2.5rem; color: #eee; font-weight: 900;">:</div>
                <div class="team-box team-b">
                    <span class="label-sm">í°ìŠ¤</span>
                    <div class="score-large" id="lScoreB">0</div>
                    <div class="score-small" id="sScoreB">0</div>
                    <div id="badgeB" class="pos-badge">ëŒ€ê¸°</div>
                </div>
            </div>

            <div class="action-grid">
                <button class="btn-win btn-win-a" onclick="addWin('A')">ìš°ë¦¬íŒ€ ë“ì  <span>Q / 1</span></button>
                <button class="btn-win btn-win-b" onclick="addWin('B')">ìƒëŒ€íŒ€ ë“ì  <span>E / 2</span></button>
            </div>

            <div class="copy-bar" onclick="copyScore()">
                <span style="font-size: 0.9rem; font-weight: 700; opacity:0.8;">ì±„íŒ… ìŠ¤ì½”ì–´ ë³µì‚¬</span>
                <div id="chatDisplay" class="chat-val">00 00</div>
            </div>

            <div class="section-card" style="padding:1rem;">
                <table class="h-table">
                    <thead><tr><th>ì§„í–‰</th><th>ìš°ë¦¬íŒ€</th><th>ìƒëŒ€íŒ€</th></tr></thead>
                    <tbody id="smallHistoryBody"></tbody>
                </table>
            </div>

            <div class="settle-card">
                <div style="text-align:left;">
                    <span class="label-sm" style="color:var(--primary); margin-bottom:4px; display:block;">ğŸ’° ì˜ˆìƒ íŒ¨ë°°ê¸ˆ</span>
                    <div id="moneyDisplay" class="money-val">0ì› (0ì–µ)</div>
                </div>
                <button class="btn-copy-num" onclick="copyRawMoney()">ìˆ«ì ë³µì‚¬</button>
            </div>
        </div>

        <footer>
            <div class="sig-line"></div>
            <span class="sig-crafted">Crafted by</span>
            <div class="sig-habom">HABOM</div>
        </footer>
    </div>

    <!-- [íƒ­ 2] ì¸ì› ê³„ì‚°ê¸° ì„¹ì…˜ -->
    <div id="tab-calculator" class="tab-content">
        <header>
            <h1>ğŸ‘¥ RPì¸ì› ê³„ì‚°ê¸° ğŸ‘¥</h1>
            <span class="sub-title">âœ¨ RP í• ë˜ë§ë˜? í• ë˜ë§ë˜? ğŸ¤·â€â™‚ï¸</span>
            <button class="help-icon" onclick="toggleHelp(true)">?</button>
        </header>

        <div class="summary-box">
            <div class="step-indicator" id="ind-1"><span class="label">ì „ì²´</span><span class="val" id="sum-1">0</span></div>
            <div class="step-indicator" id="ind-2"><span class="label">ì ìˆ˜</span><span class="val" id="sum-2">0</span></div>
            <div class="step-indicator" id="ind-3"><span class="label">íŒë§¤</span><span class="val" id="sum-3">0</span></div>
        </div>

        <div id="hero-section" class="input-hero">
            <span class="title" id="step-title">ì „ì²´ ì ‘ì† ì¸ì›ì„ ì…ë ¥í•˜ì„¸ìš”</span>
            <span class="number" id="current-val">0</span>
        </div>

        <div id="numpad-ui" class="numpad">
            <button class="key" onclick="pressNum(1)">1</button>
            <button class="key" onclick="pressNum(2)">2</button>
            <button class="key" onclick="pressNum(3)">3</button>
            <button class="key" onclick="pressNum(4)">4</button>
            <button class="key" onclick="pressNum(5)">5</button>
            <button class="key" onclick="pressNum(6)">6</button>
            <button class="key" onclick="pressNum(7)">7</button>
            <button class="key" onclick="pressNum(8)">8</button>
            <button class="key" onclick="pressNum(9)">9</button>
            <button class="key del" onclick="pressDel()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><line x1="18" y1="9" x2="12" y2="15"></line><line x1="12" y1="9" x2="18" y2="15"></line></svg>
            </button>
            <button class="key" onclick="pressNum(0)">0</button>
            <button class="key enter" onclick="pressEnter()">í™•ì¸</button>
        </div>

        <div id="party-selection" style="display:none;">
            <div class="section-card">
                <div class="section-header">
                    <span style="font-size:1.2rem">ğŸ”«</span><span class="title">ì§€ìƒ íŒŒí‹°</span>
                </div>
                <div class="btn-grid">
                    <button class="p-btn highlight" style="grid-column: span 4; height: 56px; margin-bottom: 5px; font-size:1.05rem;" onclick="addParty('GC', 7)">ì§€ì”¨ 7ì¸</button>
                    <button class="p-btn" onclick="addParty('GC', 2)">2ì¸(ì§€ë””)</button>
                    <button class="p-btn" onclick="addParty('GC', 3)">3ì¸(ì§€ë””)</button>
                    <button class="p-btn" onclick="addParty('GC', 4)">4ì¸(ì§€ë””)</button>
                    <button class="p-btn" onclick="addParty('GC', 6)">6ì¸(ì§€ì”¨)</button>
                </div>
            </div>
            <div class="section-card">
                <div class="section-header">
                    <span style="font-size:1.2rem">ğŸš—</span><span class="title">ê²Œì°¨ íŒŒí‹°</span>
                </div>
                <div class="btn-grid">
                    <button class="p-btn" onclick="addParty('GE', 3)">3ì¸</button>
                    <button class="p-btn" onclick="addParty('GE', 4)">4ì¸</button>
                    <button class="p-btn" onclick="addParty('GE', 5)">5ì¸</button>
                    <button class="p-btn" onclick="addParty('GE', 6)">6ì¸</button>
                    <button class="p-btn" onclick="addParty('GE', 7)">7ì¸</button>
                    <button class="p-btn" onclick="addParty('GE', 8)">8ì¸</button>
                    <button class="p-btn" onclick="addParty('GE', 9)">9ì¸</button>
                    <button class="p-btn" onclick="addParty('GE', 10)">10ì¸</button>
                </div>
            </div>
            <div style="padding: 0 10px; margin-bottom: 2.5rem;">
                <span style="font-size: 0.9rem; font-weight: 700; color: var(--toss-text-desc); display: block; margin-bottom: 12px;">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ íŒŒí‹°</span>
                <div id="party-list" style="display: flex; flex-wrap: wrap; gap: 10px;">ëª©ë¡ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.</div>
            </div>
        </div>

        <div class="result-box-container" id="result-box">
            <div class="result-card">
                <span class="label">ì¦‰ì‹œ ëŒ€ì‘ ê°€ëŠ¥ ê°€ìš© ì¸ì›</span>
                <div class="res-num" id="final-num">0</div>
                <div class="preview-box" id="preview-text">-</div>
                <button class="copy-btn" onclick="copyResult()">ğŸ“‹ ëŒ€ì‘ê°€ëŠ¥ í˜„í™© ë³µì‚¬í•˜ê¸°</button>
            </div>
        </div>

        <footer>
            <div class="sig-line"></div>
            <span class="sig-crafted">Crafted by</span>
            <div class="sig-habom">HABOM</div>
        </footer>
    </div>
</div>

<!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ - ì´ëª¨ì§€ ì ìš© ë° í† ìŠ¤ ìŠ¤íƒ€ì¼ íƒ­ -->
<nav class="bottom-nav">
    <div class="nav-item active" id="nav-scoreboard" onclick="switchTab('scoreboard', this)">
        <div class="emoji-icon">âš”ï¸</div>
        <span>ìŠ¤ì½”ì–´ë³´ë“œ</span>
    </div>
    
    <div class="nav-item" id="nav-calculator" onclick="switchTab('calculator', this)">
        <div class="emoji-icon">ğŸ‘¥</div>
        <span>ì¸ì› ê³„ì‚°ê¸°</span>
    </div>
    
    <div class="nav-item" onclick="if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) location.reload()">
        <div class="emoji-icon">ğŸ”ƒ</div>
        <span>ì „ì²´ ì´ˆê¸°í™”</span>
    </div>
</nav>

<script>
    /* íƒ­ ì‹œìŠ¤í…œ */
    function switchTab(tabId, el) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        
        document.getElementById(`tab-${tabId}`).classList.add('active');
        el.classList.add('active');
        window.scrollTo(0,0);
    }

    /* ì „ì—­ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í†µí•© (ì¸ì› ê³„ì‚°ê¸° ìˆ«ìí‚¤ ì…ë ¥ ë³µêµ¬) */
    window.addEventListener('keydown', e => { 
        if (document.activeElement.tagName === 'SELECT' || document.activeElement.tagName === 'INPUT') return; 
        
        const isCalcActive = document.getElementById('tab-calculator').classList.contains('active');
        const isBoardActive = document.getElementById('tab-scoreboard').classList.contains('active');

        // 1. ê³„ì‚°ê¸° í™œì„±í™” ìƒíƒœì¼ ë•Œ ìˆ«ì í‚¤íŒ¨ë“œ ì…ë ¥ ì²˜ë¦¬
        if (isCalcActive) {
            if (e.key >= '0' && e.key <= '9') {
                e.preventDefault();
                pressNum(parseInt(e.key));
            } else if (e.key === 'Enter') {
                e.preventDefault();
                pressEnter();
            } else if (e.key === 'Backspace') {
                e.preventDefault();
                pressDel();
            }
        }

        // 2. ìŠ¤ì½”ì–´ë³´ë“œ í™œì„±í™” ìƒíƒœì¼ ë•Œ ë“ì  ë‹¨ì¶•í‚¤ ì²˜ë¦¬
        if (isBoardActive && sbState.isStarted) {
            const k = e.key.toLowerCase(); 
            if (k === 'q' || k === '1') addWin('A'); 
            else if (k === 'e' || k === '2') addWin('B'); 
        }
    });

    /* --- [ê³„ì‚°ê¸° ë¡œì§] --- */
    let calcStep = 1;
    let calcValues = { total: "0", afk: "0", sales: "0" };
    let calcParties = [];

    function pressNum(num) {
        if (calcStep > 3) return;
        const key = calcStep === 1 ? "total" : calcStep === 2 ? "afk" : "sales";
        if (calcValues[key] === "0") calcValues[key] = num.toString();
        else calcValues[key] += num.toString();
        document.getElementById('current-val').innerText = calcValues[key];
    }

    function pressDel() {
        if (calcStep > 3) return;
        const key = calcStep === 1 ? "total" : calcStep === 2 ? "afk" : "sales";
        calcValues[key] = calcValues[key].slice(0, -1) || "0";
        document.getElementById('current-val').innerText = calcValues[key];
    }

    function pressEnter() {
        if (calcStep <= 3) {
            document.getElementById(`sum-${calcStep}`).innerText = calcValues[calcStep === 1 ? "total" : calcStep === 2 ? "afk" : "sales"];
            document.getElementById(`ind-${calcStep}`).classList.remove('active');
            
            if (calcStep < 3) {
                calcStep++;
                document.getElementById(`ind-${calcStep}`).classList.add('active');
                document.getElementById('step-title').innerText = calcStep === 2 ? "ì ìˆ˜/ìë¦¬ë¹„ì›€ ì¸ì›ì„ ì…ë ¥í•˜ì„¸ìš”" : "íŒë§¤ì§ ê·¼ë¬´ ì¸ì›ì„ ì…ë ¥í•˜ì„¸ìš”";
                document.getElementById('current-val').innerText = calcValues[calcStep === 2 ? "afk" : "sales"];
            } else {
                document.getElementById('hero-section').style.display = 'none';
                document.getElementById('numpad-ui').style.display = 'none';
                document.getElementById('party-selection').style.display = 'block';
                document.getElementById('result-box').style.display = 'block';
                calcStep = 4;
                calculateRP();
            }
        }
    }

    function addParty(type, count) { calcParties.push({type, count}); calculateRP(); }
    function removeParty(idx) { calcParties.splice(idx, 1); calculateRP(); }

    function calculateRP() {
        const total = parseInt(calcValues.total);
        const afk = parseInt(calcValues.afk);
        const sales = parseInt(calcValues.sales);
        const netActive = Math.max(0, total - afk);
        const groundSum = calcParties.filter(p => p.type === 'GC').reduce((a, b) => a + b.count, 0);
        const gechaSum = calcParties.filter(p => p.type === 'GE').reduce((a, b) => a + b.count, 0);
        const final = Math.max(0, netActive - sales - (groundSum + gechaSum));
        
        document.getElementById('final-num').innerText = final;
        
        const listContainer = document.getElementById('party-list');
        if (calcParties.length === 0) listContainer.innerHTML = "<span style='color:#adb5bd; font-size:0.9rem;'>ëª©ë¡ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.</span>";
        else {
            listContainer.innerHTML = calcParties.map((p, i) => {
                let label = p.type === 'GC' ? (p.count >= 6 ? 'ì§€ì”¨' : 'ì§€ë””') : 'ê²Œì°¨';
                return `<div onclick="removeParty(${i})" style="background:#f2f4f6; padding:8px 16px; border-radius:2rem; font-size:0.9rem; font-weight:700; color:var(--toss-text-sub); cursor:pointer; display:flex; align-items:center; gap:6px;">${label}(${p.count}) <span style="color:var(--danger);">Ã—</span></div>`;
            }).join('');
        }
        
        const gcCount = calcParties.filter(p => p.type === 'GC' && (p.count === 6 || p.count === 7)).length;
        const gdCount = calcParties.filter(p => p.type === 'GC' && (p.count >= 2 && p.count <= 4)).length;
        const text = `ì´ì› ${netActive}ëª… / ì§€ì”¨ ${gcCount} / ì§€ë”” ${gdCount} / ê²Œì°¨ ${gechaSum}ëª… / íŒë§¤ì§ ${sales}ëª… / ëŒ€ì‘ê°€ëŠ¥ ${final}ëª…`;
        document.getElementById('preview-text').innerText = text;
    }

    function copyResult() {
        const t = document.getElementById('preview-text').innerText;
        navigator.clipboard.writeText(t).then(() => {
            const b = document.querySelector('.copy-btn');
            const old = b.innerText; b.innerText = "âœ… ë³µì‚¬ ì™„ë£Œ";
            setTimeout(() => b.innerText = old, 1500);
        });
    }

    /* --- [ìŠ¤ì½”ì–´ë³´ë“œ ë¡œì§] --- */
    let sbState = { isStarted: false, initial: 'A', currentSetAttacker: 'A', largeA: 0, largeB: 0, smallA: 0, smallB: 0, roundLogs: [], reverseTurn: 'B' };

    function setInitial(t) { 
        sbState.isStarted = true; sbState.initial = t; sbState.currentSetAttacker = t; sbState.reverseTurn = (t === 'A') ? 'B' : 'A'; 
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('board-screen').style.display = 'block';
        document.getElementById('miniA').className = t === 'A' ? 'btn-init-mini active-a' : 'btn-init-mini';
        document.getElementById('miniB').className = t === 'B' ? 'btn-init-mini active-b' : 'btn-init-mini';
        renderScoreboard(); 
    }

    function addWin(t) { 
        if(!sbState.isStarted) return; 
        let p = sbState.smallA + sbState.smallB, f = (p % 2 !== 0); 
        let sA = (sbState.currentSetAttacker === 'A') ? (f ? 'ìˆ˜ë¹„' : 'ê³µê²©') : (f ? 'ê³µê²©' : 'ìˆ˜ë¹„'); 
        sbState.roundLogs.push({ winner: t, sideA: sA, sideB: (sA === 'ê³µê²©' ? 'ìˆ˜ë¹„' : 'ê³µê²©') }); 
        
        if(t === 'A') sbState.smallA++; else sbState.smallB++; 

        if(sbState.smallA === 3 || sbState.smallB === 3) { 
            if(t === 'A') sbState.largeA++; else sbState.largeB++; 
            sbState.currentSetAttacker = sbState.reverseTurn; 
            sbState.reverseTurn = (sbState.reverseTurn === 'A') ? 'B' : 'A'; 
            sbState.smallA = 0; sbState.smallB = 0; sbState.roundLogs = []; 
        } 
        renderScoreboard(); 
    }

    function renderScoreboard() {
        if(!sbState.isStarted) return;
        document.getElementById('lScoreA').innerText = sbState.largeA; 
        document.getElementById('lScoreB').innerText = sbState.largeB;
        document.getElementById('sScoreA').innerText = sbState.smallA; 
        document.getElementById('sScoreB').innerText = sbState.smallB;

        let p = sbState.smallA + sbState.smallB, f = (p % 2 !== 0);
        let sA = (sbState.currentSetAttacker === 'A') ? (f ? 'ìˆ˜ë¹„' : 'ê³µê²©') : (f ? 'ê³µê²©' : 'ìˆ˜ë¹„');
        
        const bA = document.getElementById('badgeA'); const bB = document.getElementById('badgeB');
        bA.innerText = sA; bA.className = sA === 'ê³µê²©' ? 'pos-badge bg-atk' : 'pos-badge bg-def';
        bB.innerText = (sA === 'ê³µê²©' ? 'ìˆ˜ë¹„' : 'ê³µê²©'); bB.className = sA === 'ìˆ˜ë¹„' ? 'pos-badge bg-atk' : 'pos-badge bg-def';

        document.getElementById('revTeam').innerText = sbState.reverseTurn === 'A' ? 'ìš°ë¦¬íŒ€' : 'ìƒëŒ€íŒ€';
        document.getElementById('chatDisplay').innerText = `${sbState.largeA}${sbState.largeB} ${sbState.smallA}${sbState.smallB}`;
        
        const m = Math.abs(sbState.largeA - sbState.largeB) * document.getElementById('mems').value * (document.getElementById('betAmount').value * 10000000);
        document.getElementById('moneyDisplay').innerText = `${m.toLocaleString()}ì› (${(m/100000000).toFixed(1)}ì–µ)`; 
        document.getElementById('moneyDisplay').dataset.raw = m;

        const sb = document.getElementById('smallHistoryBody'); sb.innerHTML = '';
        for(let i=0; i<5; i++) {
            const l = sbState.roundLogs[i];
            sb.innerHTML += `<tr><td>ë¼ìš´ë“œ ${i+1}</td><td class="${l&&l.winner==='A'?'hist-winner-a':''}">${l&&l.winner==='A'?'['+l.sideA+'] ë“ì ':'-'}</td><td class="${l&&l.winner==='B'?'hist-winner-b':''}">${l&&l.winner==='B'?'['+l.sideB+'] ë“ì ':'-'}</td></tr>`;
        }
    }

    function copyScore() { 
        const t = document.getElementById('chatDisplay').innerText; 
        navigator.clipboard.writeText(t).then(() => { 
            const a = document.querySelector('.copy-bar'); const old = a.innerHTML;
            a.innerText = 'âœ… ì±„íŒ… ìŠ¤ì½”ì–´ ë³µì‚¬ ì™„ë£Œ'; a.style.background = '#40c057';
            setTimeout(() => { a.innerHTML = old; a.style.background = 'var(--toss-text-main)'; }, 600); 
        }); 
    }

    function copyRawMoney() { navigator.clipboard.writeText(document.getElementById('moneyDisplay').dataset.raw || "0"); }

    function toggleHelp(show) {
        if(show) alert("ì „ì²´/ì ìˆ˜/íŒë§¤ì§ ì¸ì›ì„ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”.\nì´í›„ ì§€ìƒ/ê²Œì°¨ íŒŒí‹°ë¥¼ ì¶”ê°€í•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°€ìš© ì¸ì›ì´ ê³„ì‚°ë©ë‹ˆë‹¤.");
    }

    document.getElementById('ind-1').classList.add('active');
</script>

</body>
</html>
